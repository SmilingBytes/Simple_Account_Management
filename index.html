<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Simple Account Managment System</title>
	<meta name="description" content="Source code generated using layoutit.com">
	<meta name="author" content="LayoutIt!">

	<link href="css/bootstrap.min.css" rel="stylesheet" media="all">
	<link href="css/style.css" rel="stylesheet" media="screen">
	<link href="css/jquery.dataTables.min.css" rel="stylesheet" media="screen"/>
	<link href="css/bootstrap-select.css" rel="stylesheet" media="screen"/>
	<link href="css/print.css" rel="stylesheet" media="print"/>
	<link rel="stylesheet" href="css/alertify.core.css" />
	<link rel="stylesheet" href="css/alertify.default.css" id="toggleCSS" />

	<script src="js/jquery.min.js"  type="text/javascript" charset="utf-8"></script>	
	<script src="js/jquery.tabletoCSV.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/jquery.tabletoTXT.js" type="text/javascript" charset="utf-8"></script>
	<script>	
		//Export table as CSV
        $(function(){
            $("#export").click(function(){
                $("#dataTable").tableToCSV();
            });
        });
    </script>
	<script>	
		//Export table as TXT
        $(function(){
            $("#exportTXT").click(function(){
                $("#dataTable").tableToTXT();
            });
        });
    </script>
	
</head>
<body onload="bodyLoad();">
	<div class="container">
		<div class="row header">
			<div class="col-md-3">
				<img class="img imgZen img-responsive" alt="Admin Profile Picture" src="img/Ismail_H_Rana.jpg" />
			</div>
			<div class="col-md-6">
				<div class="page-header">
					<h1 class="text-center text-primary">Account Management System</h1>
				</div>
			</div>
			<div class="col-md-3">
				<img class="img img-responsive pull-right" alt="BPrinter" src="img/printer.png" />
			</div>
			<div class="col-md-8">
				<span class="text-primary pull-left name" id="iname">M Rana</span>
			</div>
			<div class="col-md-4">
				<span class="statistics pull-right">
					<button class="btn btn-success statBtn" type="button">
						Customers <span class="totalCustomers badge"></span>
					</button>
					<button class="btn btn-info active statBtn" type="button">
						Amount <span class="amount badge"></span>
					</button>
				</span>
			</div>
		</div>
		<div class="row bgw">
			<div id="alertMe" class="col-md-6 col-md-offset-3 pos5">
			</div>
		</div>
		
		<!--  Login Area -->
		<div class="row bg-success pd login">
			<div class="col-md-5 col-md-offset-3">
				<form class="form-horizontal" onsubmit="return adminLogin();">
					<div class="form-group">
						<label for="inputEmail3" class="col-sm-4 control-label">Admin ID</label>
						<div class="col-sm-8">
							<input type="text" required="required" class="form-control" id="aname" placeholder="Admin ID">
						</div>
					</div>
					<div class="form-group">
						<label for="inputPassword3" class="col-sm-4 control-label">Password</label>
						<div class="col-sm-8">
							<input type="password" required="required" class="form-control" id="apass" placeholder="Password">
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button type="submit" class="btn btn-success pull-right">Sign In</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<!-- Change password area -->
		<div class="row bg-success pd changepass">
			<div class="col-md-5 col-md-offset-3">
				<form class="form-horizontal" onsubmit="return changePass();">
					<div class="form-group">
						<label for="inputEmail3" class="col-sm-4 control-label">Current ID</label>
						<div class="col-sm-8">
							<input type="text" required="required" class="form-control" id="cid" placeholder="Admin ID">
						</div>
					</div>
					<div class="form-group">
						<label for="inputEmail3" class="col-sm-4 control-label">New ID</label>
						<div class="col-sm-8">
							<input type="text" required="required" class="form-control" id="nid" placeholder="Admin ID">
						</div>
					</div>
					
					<div class="form-group">
						<label for="inputPassword3" class="col-sm-4 control-label">Current Password</label>
						<div class="col-sm-8">
							<input type="password" required="required" class="form-control" id="cpass" placeholder="Password">
						</div>
					</div>
					 <div class="form-group">
						<label for="inputPassword3" class="col-sm-4 control-label">New Password</label>
						<div class="col-sm-8">
							<input type="password" required="required" class="form-control" id="npass" placeholder="Password">
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button type="submit" class="btn btn-success pull-right">Change Password</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<!--  Admin Area -->
		<div class="row bg-success pd admin">
			<div class="col-md-4 col-md-offset-1 noPrint">
				<form class="form-horizontal" onsubmit="return addUser();">
					<div class="form-group">
						<label for="inputEmail3" class="col-sm-2 control-label">Name</label>
						<div class="col-sm-10">
							<input type="text" required="required" class="form-control" id="newName" placeholder="New Customer Name">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">Info</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="info" placeholder="Customer Information">
						</div>
					</div>
					<div class="form-group">
						<label  class="col-sm-2 control-label">TK</label>
						<div class="col-sm-10">
							<input type="number" required="required" class="form-control" id="bdt" placeholder="Taka">
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<input type="submit" class="btn btn-success pull-right" value="Add Customer"/>
						</div>
					</div>
				</form>
			</div>
			<div class="col-md-4 col-md-offset-1 noPrint">
				<form class="form-horizontal" onsubmit="return addBDT();">
					<div class="form-group">
						<label class="sr-only" for="exampleInputAmount">Customer</label>
						<div class="input-group col-sm-10">
							<div class="input-group-addon"><span class="glyphicon glyphicon-user" aria-hidden="true"></span></div>
							<select id="c_Name" required="required" class="selectpicker show-menu-arrow form-control" data-live-search="true"  data-live-search-style="begins" data-style="btn-primary" data-size="7" name="c_Name"  title="Please select a Customer">
								<script>
									customers = JSON.parse(localStorage["customers"]);
									info = JSON.parse(localStorage["info"]);
									var results = " ";
									for(i=0;i<customers.length; i++){
										results = results+ '<option data-subtext="'+info[i]+'" value="'+customers[i]+'">'+customers[i]+'</option>';
									}
									document.write(results);
								</script>
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="sr-only" for="exampleInputAmount">BDT</label>
						<div class="input-group col-sm-10">
							<div class="input-group-addon"> $ </div>
							<input type="number" required="required" class="form-control" id="bd_taka" placeholder="Taka">
						</div>
					</div>
					<div class="form-group col-sm-12">
						<div class="col-sm-offset-2 col-sm-10">
							<button type="submit" class="btn btn-primary pull-right">Add Money</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<div class="row jumbotron mg5 admin">
			<div class="col-md-10 col-md-offset-1">
				<center><h2 class="text-center text-primary">Results</h2></center><br />
				<table id="dataTable" class="table table-hover table-condensed table-bordered table-striped">
					<thead>
						<tr class="danger">
							<th class="col-md-1">SL No</th>
							<th class="col-md-3">Name</th>
							<th class="col-md-3">Info</th>
							<th class="col-md-1">Taka</th>
							<th class="col-md-5">Status</th>
						</tr>
					</thead>
					<tbody>
						<script>
							tk = JSON.parse(localStorage["bdt"]);
							customers = JSON.parse(localStorage["customers"]);
							info = JSON.parse(localStorage["info"]);
							var results = " ";
							var sl = 1;
							for(i=0;i<customers.length; i++){
								if( Number(tk[i]) == 0 )
									continue;
								results = results+ '<tr><td>'+sl +'</td><td>'+customers[i] +'</td><td>'+info[i] +'</td><td>'+tk[i]+'</td><td> </td></tr>';
								sl++;
							}
							document.write(results);
						</script>
					</tbody>
				</table><br />
				<span class="badge">
					<button id="export" data-export="export" class="btn btn-primary">Export as CSV</button>
				</span>
				<span class="badge pull-right">
					<button id="exportTXT" data-export="export" class="btn btn-danger">Export as TXT</button>
				</span>
				
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row footer">
			<div class="col-md-3 col-offset-2">
				<span class="pull-right">
					<script>
						if (sessionStorage.sid && sessionStorage.spass) {
							if(sessionStorage.sid == localStorage.id && sessionStorage.spass == localStorage.pass){
								var adminOption = '<button class="btn btn-link" onclick="logOut();">Sign Out</button> <button class="btn btn-link" onclick="changePassView();">Change Password</button>';
								document.write(adminOption);
							}
						}
					</script>
				</span>
			</div>
			<div class="col-md-4">
				 <span class="pull-right">Coded by<a href="https://github.com/beyMax" class="btn btn-link " type="button"> Ismail H Rana</a></span>
			</div>
		</div>
	</div>
	
	
	<script>
		var tk = [];
		var info = [];
		var customers = [];
		var totalBDT = 0;
		
		function bodyLoad(){
			checkLog();
			checkAlert();
		}
		//login check for admin access 
		function checkLog(){
			if (sessionStorage.sid && sessionStorage.spass) {
				if(sessionStorage.sid == localStorage.id && sessionStorage.spass == localStorage.pass){
					$(".admin").css( "display", "block" );
					$(".login").css( "display", "none" );
					customers = JSON.parse(localStorage["customers"]);
					tk = JSON.parse(localStorage["bdt"]);
					for(i=0; i<customers.length; i++)
						totalBDT = totalBDT + Number(tk[i]);						
					$(".amount").html(totalBDT+"  TK");
					$("iname").innerHTML = " "+localStorage.id+" ";
					$("#iname").html(localStorage.id);
					$(".totalCustomers").html(customers.length);
					return false;
				}else{
					$(".admin").css( "display", "none" );
					$(".login").css( "display", "block" );
					return false;
				}
			}else {
				$(".admin").css( "display", "none" );
				$(".login").css( "display", "block" );
				if(!localStorage.id && !localStorage.pass){
					reset();
					alertify.set({ delay: 10000 });
					alertify.log("<h4>SetUp ID and Password</h4>Set your admin ID and Passwword");
				}
				return false;
			}
		}
		
		function checkAlert(){
			if(sessionStorage.success){
				reset();
				alertify.success(sessionStorage.success);
				window.sessionStorage.removeItem("success");
			}else if(sessionStorage.error){
				reset();
				alertify.error(sessionStorage.error);
				window.sessionStorage.removeItem("error");
			}
		}
		//admin login function
		function adminLogin(){
			var aid = document.getElementById("aname").value;
			var apass = document.getElementById("apass").value;
			if (localStorage.id && localStorage.pass) {
				if(aid == localStorage.id && apass == localStorage.pass){
					sessionStorage.sid = localStorage.id;
					sessionStorage.spass = localStorage.pass;
					//sessionStorage.success = "Login successfull";
					window.location.reload();
					return false;
				}else{
					reset();
					alertify.error('Admin access restricted for <strong>WRONG ID OR PASSWORD</strong>');
					return false;
				}
			}else {
				localStorage.id = aid;
				localStorage.pass = apass;
				reset();
				alertify.set({ delay: 5000 });
				alertify.log("Admin Login setup successfully done.");
				return false;
			}
		}
		
		//Add customer function
		function addUser(){
			var nName = document.getElementById("newName").value;
			var information = document.getElementById("info").value;
			var taka = document.getElementById("bdt").value;
			nName = nName.toUpperCase();
			
			var n = 0;
			var patt = /\S/g;
			var ch = nName.match(patt);
			n = ch.length;
			if(n>2){
				if(localStorage["customers"] && localStorage["bdt"] && localStorage["info"]){
					customers = JSON.parse(localStorage["customers"]);
					tk = JSON.parse(localStorage["bdt"]);
					info = JSON.parse(localStorage["info"]);
					index = customers.indexOf(nName);
					var money = tk[index];
					i = customers.length;
					if(index < 0){
						customers[i] = nName;
						tk[i] = taka;
						info[i] = information;
						
						localStorage["customers"] = JSON.stringify(customers);
						localStorage["bdt"] = JSON.stringify(tk);
						localStorage["info"] = JSON.stringify(info);
						
						sessionStorage.success = nName+' added successfully with taka <b class="txt-large badge">'+taka+'</b>';
						window.location.reload();
						return false;
					}else{
						sessionStorage.error = '<h4>Already EXIST !!!</h4>'+nName+' already exist with TK  <b class="txt-large badge">'+money+' </b>';
						window.location.reload();
						return false;
					}
				}else{
					//new user
					customers[0] = nName;
					tk[0] = taka;
					info[0] = information;
					localStorage["customers"] = JSON.stringify(customers);
					localStorage["bdt"] = JSON.stringify(tk);
					localStorage["info"] = JSON.stringify(info);
				}
			}else{
				sessionStorage.error = '<h4> Name ERROR!!!</h4>Rules:<br />    1. All characters allowed<br />    2. Minimum 3 letters</div> ';
				window.location.reload();
				return false;
			}
			return false;
		}
		
		//Add money function
		function addBDT(){
			var cName = document.getElementById("c_Name").value;
			var taka = document.getElementById("bd_taka").value;
			checkLog();
			
			customers = JSON.parse(localStorage["customers"]);
			tk = JSON.parse(localStorage["bdt"]);
			
			mName = cName.toUpperCase();
			var n = customers.indexOf(mName);
			var money = tk[n];
			if(n>=0){
				
				tk[n] = Number(money) + Number(taka);
				localStorage["bdt"] = JSON.stringify(tk);
				tk = JSON.parse(localStorage["bdt"]);
				
				sessionStorage.success = '<br />New amount for <b>'+cName+' </b> is BDT <b class="txt-large badge">'+tk[n] +'</b> ';
				window.location.reload();
				return false;
			}else{
				sessionStorage.error = 'Money Addition ERROR!!!';
				window.location.reload();
				return false;
			}
		}
		
		function changePassView(){
			$(".admin").css( "display", "none" );
			$(".login").css( "display", "none" );
			$(".changepass").css( "display", "block" );
		}
		function changePass(){
			var cid = document.getElementById("cid").value;
			var nid = document.getElementById("nid").value;
			var cpass = document.getElementById("cpass").value;
			var npass = document.getElementById("npass").value;
			//checkLog();
			
			if(cid = localStorage.id && cpass == localStorage.pass){
				var idLangth = nid.length;
				var passLangth = npass.length;
				if(idLangth>2 && passLangth>3){
					localStorage.id = nid;
					localStorage.pass = npass;
					sessionStorage.success = "You've successfully changed your password.";
					window.location.reload();
					return false;
				}else{
					sessionStorage.error = '<h4> Failed</h4>Password does not changed.<br >Rules:<br />   1. Minimum ID length is 3<br />   2. Minimum Password length is 4.';
					window.location.reload();
					return false;
				}
			}else{
				sessionStorage.error = 'Mismatched current ID and password.';
				window.location.reload();
				return false;
			}
		}
		
		function autoClosingAlert(selector, delay) {
			var alert = $(selector).alert();
			window.setTimeout(function() { alert.alert('close') }, delay);
		}
		
		function logOut(){
		    window.sessionStorage.clear();
			sessionStorage.success = 'Successfull logout';
			window.location.reload();
		}
	</script>
	
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-select.min.js"></script>
    <script src="js/jquery.dataTables.min.js"></script>
	
	<script>
		//Data table plugin
		$(document).ready(function() {
			$('#dataTable').dataTable();
		} );
	</script>
	
	<script src="js/alertify.min.js"></script>
	<script>
		function reset () {
			$("#toggleCSS").attr("href", "css/alertify.default.css");
			alertify.set({
				labels : {
					ok     : "OK",
					cancel : "Cancel"
				},
				delay : 5000,
				buttonReverse : false,
				buttonFocus   : "ok"
			});
		}
	</script>
</body>
</html>
